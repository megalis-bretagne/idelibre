/**
 * @fileoverview added by tsickle
 * Generated from: lib/component/color-picker/color-picker.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, forwardRef, HostListener, Input, Output, Renderer2, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
export class ColorPickerComponent {
    /**
     * @param {?} renderer2
     * @param {?} element
     */
    constructor(renderer2, element) {
        this.renderer2 = renderer2;
        this.element = element;
        // input for hex color
        this.size = 200; // height == width
        // height == width
        this.changed = new EventEmitter();
        this.isdown = false; // mouse down on 'slider' element
        // mouse down on 'slider' element
        this.sqIsDown = false; // mouse down on 'picker' element
        // mouse down on 'picker' element
        this.isHidden = false;
        /**
         * The element make an HSV as it's much more easy to calculate with a color picker
         * H : hue
         * S : saturation
         * V : value
         */
        this.hue = 0;
        this.saturation = 0;
        this.value = 0;
        // This property is used to calculate 'picker' background with specific hue, we use 'hsl' with current 'hue'
        this.cssprop = 'linear-gradient(to top, #000000, rgba(255,255,255,0)), linear-gradient(to right, #ffffff , hsl(%hue%, 100%, 50%))';
        /**
         * ***
         * ngModel required functions
         */
        this.onChange = (/**
         * @return {?}
         */
        () => {
            // tslint:disable-next-line:semicolon
        });
        this.onTouched = (/**
         * @return {?}
         */
        () => {
            // tslint:disable-next-line:semicolon
        });
    }
    // Private color, as we need setter and getter to listen to change
    /**
     * ****
     * Define color getter and setter
     * @return {?}
     */
    get color() {
        return this._color;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set color(value) {
        this.defineColor(value);
    }
    /**
     * ****
     * Define 'id' of input element and remove id of current element
     * @return {?}
     */
    ngAfterViewInit() {
        /** @type {?} */
        const id = this.element.nativeElement.getAttribute('id');
        this.renderer2.removeAttribute(this.element.nativeElement, 'id');
        this.renderer2.setAttribute(this.input.nativeElement, 'id', id);
    }
    /**
     * Update color of 'slider' and 'picker' on 'hue' change
     * @return {?}
     */
    changePickerColor() {
        this.renderer2.setStyle(this.slider.nativeElement, 'background', 'hsl(%hue%, 100%, 50%)'.replace('%hue%', '' + this.hue));
        this.renderer2.setStyle(this.picker.nativeElement, 'background', this.cssprop.replace('%hue%', '' + this.hue));
    }
    /**
     * Update _color property on change, and emit onChange event for ngModel
     * @return {?}
     */
    pickerChange() {
        /** @type {?} */
        const rgb = this.hsvToRgb();
        /** @type {?} */
        const hex = '#' + ('00' + rgb[0].toString(16).toUpperCase()).slice(-2) +
            ('00' + rgb[1].toString(16).toUpperCase()).slice(-2) +
            ('00' + rgb[2].toString(16).toUpperCase()).slice(-2);
        this._color = hex;
        this.onChange(hex);
    }
    /**
     * Set 'slider' position with 'hue' value
     * @return {?}
     */
    huePosition() {
        /** @type {?} */
        const px = Math.round(Math.max(this.hue * (this.size - 24) / 360, 0));
        this.renderer2.setStyle(this.slider.nativeElement, 'left', px - 12 + 'px');
        this.changePickerColor();
        this.pickerChange();
    }
    /**
     * Set 'pointer' position with 'saturation' and 'value' values
     * @return {?}
     */
    sqPosition() {
        /** @type {?} */
        const px = Math.round(Math.max(this.saturation * this.size / 100, 0));
        this.renderer2.setStyle(this.pointer.nativeElement, 'left', px - 12 + 'px');
        /** @type {?} */
        const py = Math.round(Math.max((100 - this.value) * this.size / 100, 0));
        this.renderer2.setStyle(this.pointer.nativeElement, 'top', py - 12 + 'px');
        this.pickerChange();
    }
    /**
     * *****
     * When we change 'hue' with mouse click, juste go to the position and emit color change
     * @param {?} event the mouse click event
     * @return {?}
     */
    changeHue(event) {
        this.hue = Math.round(event.offsetX * 360 / event.target.clientWidth);
        this.huePosition();
        this.changed.emit(this._color);
    }
    /**
     * @param {?} color
     * @return {?}
     */
    defineColor(color) {
        if (color && color.length === 7) {
            this._color = color;
            /** @type {?} */
            const R = parseInt(this._color.substring(1, 3), 16);
            /** @type {?} */
            const G = parseInt(this._color.substring(3, 5), 16);
            /** @type {?} */
            const B = parseInt(this._color.substring(5), 16);
            this.rgbToHsv(R, G, B);
            this.huePosition();
            this.sqPosition();
            this.changed.emit(this._color);
        }
    }
    /**
     * *
     * Events handlers : mouseup, mousemove and mousedown
     * @return {?}
     */
    mouseUp() {
        if (this.isdown || this.sqIsDown) {
            // Trigger event only if it was clicked
            this.changed.emit(this._color);
        }
        this.isdown = false;
        this.sqIsDown = false;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    mouseMove(event) {
        if (this.isdown) {
            /** @type {?} */
            const rect = this.slider.nativeElement.parentElement.getBoundingClientRect();
            /** @type {?} */
            const position = event.clientX - rect.left;
            this.hue = Math.round(position * 360 / rect.width);
            if (this.hue > 360) {
                this.hue = 360;
            }
            else if (this.hue < 0) {
                this.hue = 0;
            }
            this.huePosition();
        }
        if (this.sqIsDown) {
            /** @type {?} */
            const rect = this.pointer.nativeElement.parentElement.getBoundingClientRect();
            /** @type {?} */
            const xposition = event.clientX - rect.left;
            this.saturation = Math.round(xposition * 100 / rect.width);
            if (this.saturation > 100) {
                this.saturation = 100;
            }
            else if (this.saturation < 0) {
                this.saturation = 0;
            }
            /** @type {?} */
            const yposition = event.clientY - rect.top;
            this.value = 100 - Math.round(yposition * 100 / rect.height);
            if (this.value > 100) {
                this.value = 100;
            }
            else if (this.value < 0) {
                this.value = 0;
            }
            this.sqPosition();
        }
    }
    /**
     * @return {?}
     */
    huemouseDown() {
        this.isdown = true;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    sqmouseDown(event) {
        this.sqIsDown = true;
        this.mouseMove(event);
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        this.defineColor(value);
    }
    /**
     * ******
     * Utils fonctions, convert HSV <-> RGB
     * @return {?}
     */
    hsvToRgb() {
        /** @type {?} */
        const H = this.hue;
        /** @type {?} */
        const V = this.value / 100;
        /** @type {?} */
        const S = this.saturation / 100;
        /** @type {?} */
        const C = V * S;
        /** @type {?} */
        const X = C * (1 - Math.abs((H / 60) % 2 - 1));
        /** @type {?} */
        const m = V - C;
        /** @type {?} */
        let prime = [C, 0, X];
        if (H < 60) {
            prime = [C, X, 0];
        }
        else if (H < 120) {
            prime = [X, C, 0];
        }
        else if (H < 180) {
            prime = [0, C, X];
        }
        else if (H < 240) {
            prime = [0, X, C];
        }
        else if (H < 300) {
            prime = [X, 0, C];
        }
        return [
            Math.round((prime[0] + m) * 255),
            Math.round((prime[1] + m) * 255),
            Math.round((prime[2] + m) * 255)
        ];
    }
    /**
     * @param {?} R
     * @param {?} G
     * @param {?} B
     * @return {?}
     */
    rgbToHsv(R, G, B) {
        /** @type {?} */
        const Rp = R / 255;
        /** @type {?} */
        const Gp = G / 255;
        /** @type {?} */
        const Bp = B / 255;
        /** @type {?} */
        const Cmax = Math.max(Rp, Gp, Bp);
        /** @type {?} */
        const Cmin = Math.min(Rp, Gp, Bp);
        /** @type {?} */
        const Delta = Cmax - Cmin;
        /** @type {?} */
        let H = 0;
        if (Delta === 0) {
            H = 0;
        }
        else if (Cmax === Rp) {
            H = 60 * ((Gp - Bp) / Delta % 6);
        }
        else if (Cmax === Gp) {
            H = 60 * ((Bp - Rp) / Delta + 2);
        }
        else if (Cmax === Bp) {
            H = 60 * ((Rp - Gp) / Delta + 4);
        }
        /** @type {?} */
        let S = 0;
        if (Cmax !== 0) {
            S = Delta / Cmax;
        }
        this.hue = H;
        this.saturation = S * 100;
        this.value = Cmax * 100;
    }
}
ColorPickerComponent.decorators = [
    { type: Component, args: [{
                selector: 'ls-color-picker',
                template: "<div class=\"picker-container\" [style.width]=\"size + 2 + 'px'\">\n  <div #picker class=\"picker\" [style.height]=\"size + 'px'\" (mousedown)=\"sqmouseDown($event)\">\n    <div #pointer class=\"pointer\" [style.background-color]=\"color\"></div>\n  </div>\n\n  <div class=\"slider-container\">\n    <div class=\"hue\" (click)=\"changeHue($event)\"></div>\n    <div #slider class=\"slider\" [class.notclicked]=\"!isdown\" (mousedown)=\"huemouseDown()\"></div>\n  </div>\n\n  <div class=\"result-container\">\n    <span class=\"selected-color\" [style.background-color]=\"color\">\n\n    </span>\n    <input maxlength=\"7\" #input pattern=\"#[A-Fa-f0-9]{6}\" [(ngModel)]=\"color\">\n  </div>\n</div>\n",
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => ColorPickerComponent)),
                        multi: true
                    }
                ],
                styles: ["*{-webkit-box-sizing:border-box;box-sizing:border-box}.picker{width:100%;height:200px;position:relative;margin-bottom:20px}.pointer{width:22px;height:22px;background-color:#000;border-radius:11px;border:2px solid #fff;position:absolute;top:0;left:0;cursor:pointer}.hue{height:8px;width:100%;border-radius:4px;background:-webkit-gradient(linear,left top,right top,from(red),color-stop(yellow),color-stop(lime),color-stop(cyan),color-stop(blue),color-stop(magenta),to(red));background:linear-gradient(to right,red,#ff0,#0f0,#0ff,#00f,#ff00ff,red)}.slider{width:24px;height:24px;background-color:#000;border-radius:12px;border:2px solid #fff;position:absolute;top:0;left:0;cursor:pointer}.slider.notclicked{-webkit-transition:left .2s;transition:left .2s}.slider-container{height:24px;margin-left:12px;margin-right:12px;position:relative;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:20px}.selected-color{background-color:#000;display:inline-block;height:30px;width:80px;margin-right:16px;border:1px solid var(--ls-grey-200)}.picker-container{border:1px solid var(--ls-grey-200);border-bottom-left-radius:5px;border-bottom-right-radius:5px}.result-container{margin:16px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.result-container input{width:80px}"]
            }] }
];
/** @nocollapse */
ColorPickerComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef }
];
ColorPickerComponent.propDecorators = {
    picker: [{ type: ViewChild, args: ['picker',] }],
    slider: [{ type: ViewChild, args: ['slider',] }],
    pointer: [{ type: ViewChild, args: ['pointer',] }],
    input: [{ type: ViewChild, args: ['input',] }],
    size: [{ type: Input }],
    changed: [{ type: Output }],
    color: [{ type: Input }],
    mouseUp: [{ type: HostListener, args: ['document:mouseup', [],] }],
    mouseMove: [{ type: HostListener, args: ['document:mousemove', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    ColorPickerComponent.prototype.picker;
    /** @type {?} */
    ColorPickerComponent.prototype.slider;
    /** @type {?} */
    ColorPickerComponent.prototype.pointer;
    /** @type {?} */
    ColorPickerComponent.prototype.input;
    /** @type {?} */
    ColorPickerComponent.prototype.size;
    /** @type {?} */
    ColorPickerComponent.prototype.changed;
    /** @type {?} */
    ColorPickerComponent.prototype.isdown;
    /** @type {?} */
    ColorPickerComponent.prototype.sqIsDown;
    /** @type {?} */
    ColorPickerComponent.prototype.isHidden;
    /**
     * The element make an HSV as it's much more easy to calculate with a color picker
     * H : hue
     * S : saturation
     * V : value
     * @type {?}
     */
    ColorPickerComponent.prototype.hue;
    /** @type {?} */
    ColorPickerComponent.prototype.saturation;
    /** @type {?} */
    ColorPickerComponent.prototype.value;
    /** @type {?} */
    ColorPickerComponent.prototype.cssprop;
    /**
     * @type {?}
     * @private
     */
    ColorPickerComponent.prototype._color;
    /**
     * ***
     * ngModel required functions
     * @type {?}
     */
    ColorPickerComponent.prototype.onChange;
    /** @type {?} */
    ColorPickerComponent.prototype.onTouched;
    /**
     * @type {?}
     * @private
     */
    ColorPickerComponent.prototype.renderer2;
    /**
     * @type {?}
     * @private
     */
    ColorPickerComponent.prototype.element;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BsaWJyaWNpZWwvbHMtY29tcG9zYW50cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnQvY29sb3ItcGlja2VyL2NvbG9yLXBpY2tlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBRUwsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUNOLFNBQVMsRUFDVCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUF1QixpQkFBaUIsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBY3ZFLE1BQU0sT0FBTyxvQkFBb0I7Ozs7O0lBOEIvQixZQUFvQixTQUFvQixFQUFVLE9BQW1CO1FBQWpELGNBQVMsR0FBVCxTQUFTLENBQVc7UUFBVSxZQUFPLEdBQVAsT0FBTyxDQUFZOztRQXZCNUQsU0FBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLGtCQUFrQjs7UUFHdkMsWUFBTyxHQUF5QixJQUFJLFlBQVksRUFBRSxDQUFDO1FBRW5ELFdBQU0sR0FBRyxLQUFLLENBQUMsQ0FBSyxpQ0FBaUM7O1FBQ3JELGFBQVEsR0FBRyxLQUFLLENBQUMsQ0FBRyxpQ0FBaUM7O1FBQ3JELGFBQVEsR0FBRyxLQUFLLENBQUM7Ozs7Ozs7UUFTakIsUUFBRyxHQUFHLENBQUMsQ0FBQztRQUNSLGVBQVUsR0FBRyxDQUFDLENBQUM7UUFDZixVQUFLLEdBQUcsQ0FBQyxDQUFDOztRQUdWLFlBQU8sR0FBRyxtSEFBbUgsQ0FBQzs7Ozs7UUFpSzlILGFBQVE7OztRQUFRLEdBQUcsRUFBRTtZQUNuQixxQ0FBcUM7UUFDdkMsQ0FBQyxFQUFDO1FBRUYsY0FBUzs7O1FBQVEsR0FBRyxFQUFFO1lBQ3BCLHFDQUFxQztRQUN2QyxDQUFDLEVBQUM7SUFwS0YsQ0FBQzs7Ozs7OztJQU9ELElBQUksS0FBSztRQUNQLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNyQixDQUFDOzs7OztJQUVELElBQ0ksS0FBSyxDQUFDLEtBQUs7UUFDYixJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzFCLENBQUM7Ozs7OztJQUtELGVBQWU7O2NBQ1AsRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUM7UUFDeEQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ2xFLENBQUM7Ozs7O0lBS0QsaUJBQWlCO1FBQ2YsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsWUFBWSxFQUFFLHVCQUF1QixDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzFILElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLFlBQVksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2pILENBQUM7Ozs7O0lBS0QsWUFBWTs7Y0FDSixHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRTs7Y0FDckIsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BFLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV0RCxJQUFJLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQztRQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3JCLENBQUM7Ozs7O0lBS0QsV0FBVzs7Y0FDSCxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNyRSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUUzRSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDdEIsQ0FBQzs7Ozs7SUFLRCxVQUFVOztjQUNGLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNyRSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxJ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TTtvQkFpQ04sS0FBSztzQkFzRkwsWUFBWSxTQUFDLGtCQUFrQixFQUFFLEVBQUU7d0JBVW5DLFlBQVksU0FBQyxvQkFBb0IsRUFBRSxDQUFDLFFBQVEsQ0FBQzs7OztJQXhJOUMsc0NBQTRCOztJQUM1QixzQ0FBNEI7O0lBQzVCLHVDQUE4Qjs7SUFDOUIscUNBQTBCOztJQUUxQixvQ0FBb0I7O0lBRXBCLHVDQUNtRDs7SUFFbkQsc0NBQWU7O0lBQ2Ysd0NBQWlCOztJQUNqQix3Q0FBaUI7Ozs7Ozs7O0lBU2pCLG1DQUFROztJQUNSLDBDQUFlOztJQUNmLHFDQUFVOztJQUdWLHVDQUE4SDs7Ozs7SUFLOUgsc0NBQWU7Ozs7OztJQTRKZix3Q0FFRTs7SUFFRix5Q0FFRTs7Ozs7SUFyS1UseUNBQTRCOzs7OztJQUFFLHVDQUEyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBmb3J3YXJkUmVmLFxuICBIb3N0TGlzdGVuZXIsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIFJlbmRlcmVyMixcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1J9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbHMtY29sb3ItcGlja2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbG9yLXBpY2tlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NvbG9yLXBpY2tlci5jb21wb25lbnQuc2NzcyddLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IENvbG9yUGlja2VyQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfVxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBDb2xvclBpY2tlckNvbXBvbmVudCBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBBZnRlclZpZXdJbml0IHtcblxuICBAVmlld0NoaWxkKCdwaWNrZXInKSBwaWNrZXI7ICAgIC8vIHNxdWFyZSB3aXRoIGdyYWRpZW50XG4gIEBWaWV3Q2hpbGQoJ3NsaWRlcicpIHNsaWRlcjsgICAgLy8gaHVlIHNsaWRlclxuICBAVmlld0NoaWxkKCdwb2ludGVyJykgcG9pbnRlcjsgIC8vIGNvbG9yIHBvaW50ZXJcbiAgQFZpZXdDaGlsZCgnaW5wdXQnKSBpbnB1dDsgICAgICAvLyBpbnB1dCBmb3IgaGV4IGNvbG9yXG5cbiAgQElucHV0KCkgc2l6ZSA9IDIwMDsgLy8gaGVpZ2h0ID09IHdpZHRoXG5cbiAgQE91dHB1dCgpIC8vIEVtaXQgb24gJ2NvbG9yJyBwcm9wZXJ0eSBjaGFuZ2VkXG4gIGNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIGlzZG93biA9IGZhbHNlOyAgICAgLy8gbW91c2UgZG93biBvbiAnc2xpZGVyJyBlbGVtZW50XG4gIHNxSXNEb3duID0gZmFsc2U7ICAgLy8gbW91c2UgZG93biBvbiAncGlja2VyJyBlbGVtZW50XG4gIGlzSGlkZGVuID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRoZSBlbGVtZW50IG1ha2UgYW4gSFNWIGFzIGl0J3MgbXVjaCBtb3JlIGVhc3kgdG8gY2FsY3VsYXRlIHdpdGggYSBjb2xvciBwaWNrZXJcbiAgICogSCA6IGh1ZVxuICAgKiBTIDogc2F0dXJhdGlvblxuICAgKiBWIDogdmFsdWVcbiAgICovXG5cbiAgaHVlID0gMDtcbiAgc2F0dXJhdGlvbiA9IDA7XG4gIHZhbHVlID0gMDtcblxuICAvLyBUaGlzIHByb3BlcnR5IGlzIHVzZWQgdG8gY2FsY3VsYXRlICdwaWNrZXInIGJhY2tncm91bmQgd2l0aCBzcGVjaWZpYyBodWUsIHdlIHVzZSAnaHNsJyB3aXRoIGN1cnJlbnQgJ2h1ZSdcbiAgY3NzcHJvcCA9ICdsaW5lYXItZ3JhZGllbnQodG8gdG9wLCAjMDAwMDAwLCByZ2JhKDI1NSwyNTUsMjU1LDApKSwgbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCAjZmZmZmZmICwgaHNsKCVodWUlLCAxMDAlLCA1MCUpKSc7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXJlcjI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50UmVmKSB7XG4gIH1cblxuICBwcml2YXRlIF9jb2xvcjsgLy8gUHJpdmF0ZSBjb2xvciwgYXMgd2UgbmVlZCBzZXR0ZXIgYW5kIGdldHRlciB0byBsaXN0ZW4gdG8gY2hhbmdlXG5cbiAgLyoqKioqKipcbiAgICogRGVmaW5lIGNvbG9yIGdldHRlciBhbmQgc2V0dGVyXG4gICAqL1xuICBnZXQgY29sb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbG9yO1xuICB9XG5cbiAgQElucHV0KClcbiAgc2V0IGNvbG9yKHZhbHVlKSB7XG4gICAgdGhpcy5kZWZpbmVDb2xvcih2YWx1ZSk7XG4gIH1cblxuICAvKioqKioqKlxuICAgKiBEZWZpbmUgJ2lkJyBvZiBpbnB1dCBlbGVtZW50IGFuZCByZW1vdmUgaWQgb2YgY3VycmVudCBlbGVtZW50XG4gICAqL1xuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgY29uc3QgaWQgPSB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2lkJyk7XG4gICAgdGhpcy5yZW5kZXJlcjIucmVtb3ZlQXR0cmlidXRlKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LCAnaWQnKTtcbiAgICB0aGlzLnJlbmRlcmVyMi5zZXRBdHRyaWJ1dGUodGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50LCAnaWQnLCBpZCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGNvbG9yIG9mICdzbGlkZXInIGFuZCAncGlja2VyJyBvbiAnaHVlJyBjaGFuZ2VcbiAgICovXG4gIGNoYW5nZVBpY2tlckNvbG9yKCkge1xuICAgIHRoaXMucmVuZGVyZXIyLnNldFN0eWxlKHRoaXMuc2xpZGVyLm5hdGl2ZUVsZW1lbnQsICdiYWNrZ3JvdW5kJywgJ2hzbCglaHVlJSwgMTAwJSwgNTAlKScucmVwbGFjZSgnJWh1ZSUnLCAnJyArIHRoaXMuaHVlKSk7XG4gICAgdGhpcy5yZW5kZXJlcjIuc2V0U3R5bGUodGhpcy5waWNrZXIubmF0aXZlRWxlbWVudCwgJ2JhY2tncm91bmQnLCB0aGlzLmNzc3Byb3AucmVwbGFjZSgnJWh1ZSUnLCAnJyArIHRoaXMuaHVlKSk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIF9jb2xvciBwcm9wZXJ0eSBvbiBjaGFuZ2UsIGFuZCBlbWl0IG9uQ2hhbmdlIGV2ZW50IGZvciBuZ01vZGVsXG4gICAqL1xuICBwaWNrZXJDaGFuZ2UoKSB7XG4gICAgY29uc3QgcmdiID0gdGhpcy5oc3ZUb1JnYigpO1xuICAgIGNvbnN0IGhleCA9ICcjJyArICgnMDAnICsgcmdiWzBdLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpKS5zbGljZSgtMikgK1xuICAgICAgKCcwMCcgKyByZ2JbMV0udG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCkpLnNsaWNlKC0yKSArXG4gICAgICAoJzAwJyArIHJnYlsyXS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKSkuc2xpY2UoLTIpO1xuXG4gICAgdGhpcy5fY29sb3IgPSBoZXg7XG4gICAgdGhpcy5vbkNoYW5nZShoZXgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCAnc2xpZGVyJyBwb3NpdGlvbiB3aXRoICdodWUnIHZhbHVlXG4gICAqL1xuICBodWVQb3NpdGlvbigpIHtcbiAgICBjb25zdCBweCA9IE1hdGgucm91bmQoTWF0aC5tYXgodGhpcy5odWUgKiAodGhpcy5zaXplIC0gMjQpIC8gMzYwLCAwKSk7XG4gICAgdGhpcy5yZW5kZXJlcjIuc2V0U3R5bGUodGhpcy5zbGlkZXIubmF0aXZlRWxlbWVudCwgJ2xlZnQnLCBweCAtIDEyICsgJ3B4Jyk7XG5cbiAgICB0aGlzLmNoYW5nZVBpY2tlckNvbG9yKCk7XG4gICAgdGhpcy5waWNrZXJDaGFuZ2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgJ3BvaW50ZXInIHBvc2l0aW9uIHdpdGggJ3NhdHVyYXRpb24nIGFuZCAndmFsdWUnIHZhbHVlc1xuICAgKi9cbiAgc3FQb3NpdGlvbigpIHtcbiAgICBjb25zdCBweCA9IE1hdGgucm91bmQoTWF0aC5tYXgodGhpcy5zYXR1cmF0aW9uICogdGhpcy5zaXplIC8gMTAwLCAwKSk7XG4gICAgdGhpcy5yZW5kZXJlcjIuc2V0U3R5bGUodGhpcy5wb2ludGVyLm5hdGl2ZUVsZW1lbnQsICdsZWZ0JywgcHggLSAxMiArICdweCcpO1xuXG4gICAgY29uc3QgcHkgPSBNYXRoLnJvdW5kKE1hdGgubWF4KCgxMDAgLSB0aGlzLnZhbHVlKSAqIHRoaXMuc2l6ZSAvIDEwMCwgMCkpO1xuICAgIHRoaXMucmVuZGVyZXIyLnNldFN0eWxlKHRoaXMucG9pbnRlci5uYXRpdmVFbGVtZW50LCAndG9wJywgcHkgLSAxMiArICdweCcpO1xuXG4gICAgdGhpcy5waWNrZXJDaGFuZ2UoKTtcbiAgfVxuXG4gIC8qKioqKioqKlxuICAgKiBXaGVuIHdlIGNoYW5nZSAnaHVlJyB3aXRoIG1vdXNlIGNsaWNrLCBqdXN0ZSBnbyB0byB0aGUgcG9zaXRpb24gYW5kIGVtaXQgY29sb3IgY2hhbmdlXG4gICAqIEBwYXJhbSBldmVudCB0aGUgbW91c2UgY2xpY2sgZXZlbnRcbiAgICovXG4gIGNoYW5nZUh1ZShldmVudCkge1xuICAgIHRoaXMuaHVlID0gTWF0aC5yb3VuZChldmVudC5vZmZzZXRYICogMzYwIC8gZXZlbnQudGFyZ2V0LmNsaWVudFdpZHRoKTtcbiAgICB0aGlzLmh1ZVBvc2l0aW9uKCk7XG4gICAgdGhpcy5jaGFuZ2VkLmVtaXQodGhpcy5fY29sb3IpO1xuICB9XG5cbiAgZGVmaW5lQ29sb3IoY29sb3IpIHtcbiAgICBpZiAoY29sb3IgJiYgY29sb3IubGVuZ3RoID09PSA3KSB7XG4gICAgICB0aGlzLl9jb2xvciA9IGNvbG9yO1xuICAgICAgY29uc3QgUiA9IHBhcnNlSW50KHRoaXMuX2NvbG9yLnN1YnN0cmluZygxLCAzKSwgMTYpO1xuICAgICAgY29uc3QgRyA9IHBhcnNlSW50KHRoaXMuX2NvbG9yLnN1YnN0cmluZygzLCA1KSwgMTYpO1xuICAgICAgY29uc3QgQiA9IHBhcnNlSW50KHRoaXMuX2NvbG9yLnN1YnN0cmluZyg1KSwgMTYpO1xuICAgICAgdGhpcy5yZ2JUb0hzdihSLCBHLCBCKTtcbiAgICAgIHRoaXMuaHVlUG9zaXRpb24oKTtcbiAgICAgIHRoaXMuc3FQb3NpdGlvbigpO1xuXG4gICAgICB0aGlzLmNoYW5nZWQuZW1pdCh0aGlzLl9jb2xvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqKipcbiAgICogRXZlbnRzIGhhbmRsZXJzIDogbW91c2V1cCwgbW91c2Vtb3ZlIGFuZCBtb3VzZWRvd25cbiAgICovXG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50Om1vdXNldXAnLCBbXSlcbiAgbW91c2VVcCgpIHtcbiAgICBpZiAodGhpcy5pc2Rvd24gfHwgdGhpcy5zcUlzRG93bikge1xuICAgICAgLy8gVHJpZ2dlciBldmVudCBvbmx5IGlmIGl0IHdhcyBjbGlja2VkXG4gICAgICB0aGlzLmNoYW5nZWQuZW1pdCh0aGlzLl9jb2xvcik7XG4gICAgfVxuICAgIHRoaXMuaXNkb3duID0gZmFsc2U7XG4gICAgdGhpcy5zcUlzRG93biA9IGZhbHNlO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6bW91c2Vtb3ZlJywgWyckZXZlbnQnXSlcbiAgbW91c2VNb3ZlKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMuaXNkb3duKSB7XG4gICAgICBjb25zdCByZWN0ID0gdGhpcy5zbGlkZXIubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgcG9zaXRpb24gPSBldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0O1xuXG4gICAgICB0aGlzLmh1ZSA9IE1hdGgucm91bmQocG9zaXRpb24gKiAzNjAgLyByZWN0LndpZHRoKTtcbiAgICAgIGlmICh0aGlzLmh1ZSA+IDM2MCkge1xuICAgICAgICB0aGlzLmh1ZSA9IDM2MDtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5odWUgPCAwKSB7XG4gICAgICAgIHRoaXMuaHVlID0gMDtcbiAgICAgIH1cbiAgICAgIHRoaXMuaHVlUG9zaXRpb24oKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuc3FJc0Rvd24pIHtcbiAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLnBvaW50ZXIubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgeHBvc2l0aW9uID0gZXZlbnQuY2xpZW50WCAtIHJlY3QubGVmdDtcblxuICAgICAgdGhpcy5zYXR1cmF0aW9uID0gTWF0aC5yb3VuZCh4cG9zaXRpb24gKiAxMDAgLyByZWN0LndpZHRoKTtcbiAgICAgIGlmICh0aGlzLnNhdHVyYXRpb24gPiAxMDApIHtcbiAgICAgICAgdGhpcy5zYXR1cmF0aW9uID0gMTAwO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnNhdHVyYXRpb24gPCAwKSB7XG4gICAgICAgIHRoaXMuc2F0dXJhdGlvbiA9IDA7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHlwb3NpdGlvbiA9IGV2ZW50LmNsaWVudFkgLSByZWN0LnRvcDtcblxuICAgICAgdGhpcy52YWx1ZSA9IDEwMCAtIE1hdGgucm91bmQoeXBvc2l0aW9uICogMTAwIC8gcmVjdC5oZWlnaHQpO1xuICAgICAgaWYgKHRoaXMudmFsdWUgPiAxMDApIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IDEwMDtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy52YWx1ZSA8IDApIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IDA7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc3FQb3NpdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIGh1ZW1vdXNlRG93bigpIHtcbiAgICB0aGlzLmlzZG93biA9IHRydWU7XG4gIH1cblxuICBzcW1vdXNlRG93bihldmVudCkge1xuICAgIHRoaXMuc3FJc0Rvd24gPSB0cnVlO1xuICAgIHRoaXMubW91c2VNb3ZlKGV2ZW50KTtcbiAgfVxuXG5cbiAgLyoqKioqKlxuICAgKiBuZ01vZGVsIHJlcXVpcmVkIGZ1bmN0aW9uc1xuICAgKi9cbiAgb25DaGFuZ2U6IGFueSA9ICgpID0+IHtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6c2VtaWNvbG9uXG4gIH07XG5cbiAgb25Ub3VjaGVkOiBhbnkgPSAoKSA9PiB7XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnNlbWljb2xvblxuICB9O1xuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm4pIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbikge1xuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlKSB7XG4gICAgdGhpcy5kZWZpbmVDb2xvcih2YWx1ZSk7XG4gIH1cblxuXG4gIC8qKioqKioqKipcbiAgICogVXRpbHMgZm9uY3Rpb25zLCBjb252ZXJ0IEhTViA8LT4gUkdCXG4gICAqL1xuICBoc3ZUb1JnYigpIHtcbiAgICBjb25zdCBIID0gdGhpcy5odWU7XG4gICAgY29uc3QgViA9IHRoaXMudmFsdWUgLyAxMDA7XG4gICAgY29uc3QgUyA9IHRoaXMuc2F0dXJhdGlvbiAvIDEwMDtcblxuICAgIGNvbnN0IEMgPSBWICogUztcbiAgICBjb25zdCBYID0gQyAqICgxIC0gTWF0aC5hYnMoKEggLyA2MCkgJSAyIC0gMSkpO1xuICAgIGNvbnN0IG0gPSBWIC0gQztcblxuICAgIGxldCBwcmltZSA9IFtDLCAwLCBYXTtcblxuICAgIGlmIChIIDwgNjApIHtcbiAgICAgIHByaW1lID0gW0MsIFgsIDBdO1xuICAgIH0gZWxzZSBpZiAoSCA8IDEyMCkge1xuICAgICAgcHJpbWUgPSBbWCwgQywgMF07XG4gICAgfSBlbHNlIGlmIChIIDwgMTgwKSB7XG4gICAgICBwcmltZSA9IFswLCBDLCBYXTtcbiAgICB9IGVsc2UgaWYgKEggPCAyNDApIHtcbiAgICAgIHByaW1lID0gWzAsIFgsIENdO1xuICAgIH0gZWxzZSBpZiAoSCA8IDMwMCkge1xuICAgICAgcHJpbWUgPSBbWCwgMCwgQ107XG4gICAgfVxuXG4gICAgcmV0dXJuIFtcbiAgICAgIE1hdGgucm91bmQoKHByaW1lWzBdICsgbSkgKiAyNTUpLFxuICAgICAgTWF0aC5yb3VuZCgocHJpbWVbMV0gKyBtKSAqIDI1NSksXG4gICAgICBNYXRoLnJvdW5kKChwcmltZVsyXSArIG0pICogMjU1KVxuICAgIF07XG4gIH1cblxuICByZ2JUb0hzdihSLCBHLCBCKSB7XG4gICAgY29uc3QgUnAgPSBSIC8gMjU1O1xuICAgIGNvbnN0IEdwID0gRyAvIDI1NTtcbiAgICBjb25zdCBCcCA9IEIgLyAyNTU7XG5cbiAgICBjb25zdCBDbWF4ID0gTWF0aC5tYXgoUnAsIEdwLCBCcCk7XG4gICAgY29uc3QgQ21pbiA9IE1hdGgubWluKFJwLCBHcCwgQnApO1xuXG4gICAgY29uc3QgRGVsdGEgPSBDbWF4IC0gQ21pbjtcbiAgICBsZXQgSCA9IDA7XG5cbiAgICBpZiAoRGVsdGEgPT09IDApIHtcbiAgICAgIEggPSAwO1xuICAgIH0gZWxzZSBpZiAoQ21heCA9PT0gUnApIHtcbiAgICAgIEggPSA2MCAqICgoR3AgLSBCcCkgLyBEZWx0YSAlIDYpO1xuICAgIH0gZWxzZSBpZiAoQ21heCA9PT0gR3ApIHtcbiAgICAgIEggPSA2MCAqICgoQnAgLSBScCkgLyBEZWx0YSArIDIpO1xuICAgIH0gZWxzZSBpZiAoQ21heCA9PT0gQnApIHtcbiAgICAgIEggPSA2MCAqICgoUnAgLSBHcCkgLyBEZWx0YSArIDQpO1xuICAgIH1cblxuICAgIGxldCBTID0gMDtcblxuICAgIGlmIChDbWF4ICE9PSAwKSB7XG4gICAgICBTID0gRGVsdGEgLyBDbWF4O1xuICAgIH1cblxuICAgIHRoaXMuaHVlID0gSDtcbiAgICB0aGlzLnNhdHVyYXRpb24gPSBTICogMTAwO1xuICAgIHRoaXMudmFsdWUgPSBDbWF4ICogMTAwO1xuICB9XG59XG4iXX0=