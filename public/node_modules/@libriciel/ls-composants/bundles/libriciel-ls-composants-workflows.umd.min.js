!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/platform-browser/animations"),require("@angular/forms"),require("@angular/common"),require("@angular/platform-browser"),require("@ng-bootstrap/ng-bootstrap"),require("@angular/cdk/drag-drop"),require("@angular/core")):"function"==typeof define&&define.amd?define("@libriciel/ls-composants/workflows",["exports","@angular/platform-browser/animations","@angular/forms","@angular/common","@angular/platform-browser","@ng-bootstrap/ng-bootstrap","@angular/cdk/drag-drop","@angular/core"],e):e((t.libriciel=t.libriciel||{},t.libriciel["ls-composants"]=t.libriciel["ls-composants"]||{},t.libriciel["ls-composants"].workflows={}),t.ng.platformBrowser.animations,t.ng.forms,t.ng.common,t.ng.platformBrowser,t.ngBootstrap,t.ng.cdk["drag-drop"],t.ng.core)}(this,function(t,e,o,n,s,i,r,l){"use strict";var a=function(){this.steps=[]},p={PENDING:"pending",CURRENT:"current",VALIDATED:"approve",SKIPPED:"skipped",REJECTED:"rejected"},d=(c.prototype.ngOnInit=function(){if(this.circuit||(console.error("Missing input circuit data"),this.circuit=new a),!this.messages)throw new Error("Missing localised messages for LsWorkflowViewerComponent!");if(!this.getStepIconClassFct)throw new Error("Missing getStepIconClassFct for LsWorkflowViewerComponent!");if(!this.getStepTooltipFct)throw new Error("Missing getStepTooltipFct for LsWorkflowViewerComponent!")},c.prototype.ngOnChanges=function(){var t;console.debug("LsWorkflowViewerComponent::ngOnChanges, ",this),this.isInstance&&(console.debug("LsWorkflowViewerComponent::ngOnChanges - circuit is an instance "),t=this.circuit,this.activeStep=t.currentStepIdx,this.isOver=t.isOver,this.isRejected=t.rejected)},c.prototype.getStepIconClass=function(t){return this.getStepIconClassFct(t)},c.prototype.getStepTooltip=function(t){return this.getStepTooltipFct(t)},c.prototype.isActiveStep=function(t){return!this.isRejected&&!this.isOver&&t===this.activeStep},c.prototype.isPassed=function(t){return this.isInstance&&(t.state===p.VALIDATED||t.state===p.REJECTED)},c.prototype.isActualValidator=function(t,e){return this.isInstance&&t.validatedBy.some(function(t){return t.id===e.id})},c.prototype.isCircuitOver=function(){return this.isOver&&!this.isRejected},c.prototype.getCircuitEndAdditionalClasses=function(){return this.getCircuitEndAdditionalClassesFct?this.getCircuitEndAdditionalClassesFct():""},c.prototype.getValidatorClasses=function(t,e){return this.isActualValidator(t,e)?t.state===p.REJECTED?this.messages.REJECTED_BY_ICON_CLASS:this.messages.VALIDATED_BY_ICON_CLASS:""},c.decorators=[{type:l.Component,args:[{selector:"ls-workflow-model-viewer",template:'<div class="ls-workflow-display">\n  <div class="ls-workflow-canevas">\n    <div class="circuit-start">\n      <div class="ls-workflow-endpoint-content">\n        <span class="ls-workflow-endpoint-icn fa fa fa-2x" [ngClass]="messages.CIRCUIT_START_ICON"></span>\n        <span class="ls-step-bounds-txt" [innerText]="messages.FIRST_STEP_TXT"></span>\n      </div>\n    </div>\n    <div class="steps-container">\n      <div *ngFor="let step of circuit.steps; index as i" >\n        <div class="ls-workflow-display-step-container">\n          <div  class="ls-workflow-step" [ngClass]="isActiveStep(i) ? \'wa-active-step wa-white-icn\' : \'\'">\n            <div class="ls-step-top-line">\n              <div class="step-number">{{i + 1}}.</div>\n              <div class="step-name">{{step.name}}</div>\n              <div [ngClass]="getStepIconClass(step)" class="step-icn fa" ngbTooltip="{{getStepTooltip(step)}}"></div>\n            </div>\n            <div class="ls-display-step-separator"></div>\n            <div class="ls-step-validator-list" [ngClass]="isInstance ? \'wa-circuit-instance\' : \'\'">\n              <ng-container *ngIf="isPassed(step)">\n                <div *ngFor="let validator of step.validators">\n                  <ng-template\n                    [ngTemplateOutlet]="passedStepTemplateRef"\n                    [ngTemplateOutletContext]="{step: step, validator: validator}">\n                  </ng-template>\n                </div>\n              </ng-container>\n              <ng-container *ngIf=" ! isPassed(step)">\n                <div *ngFor="let validator of step.validators">\n                  <ng-template\n                    [ngTemplateOutlet]="pendingStepTemplateRef"\n                    [ngTemplateOutletContext]="{step: step, validator: validator}">\n                  </ng-template>\n                </div>\n              </ng-container>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="ls-workflow-end">\n      <div class="ls-workflow-endpoint-content" [ngClass]="getCircuitEndAdditionalClasses()">\n        <span class="ls-workflow-endpoint-icn fa fa-2x" [ngClass]="messages.CIRCUIT_END_ICON"></span>\n        <span class="ls-step-bounds-txt" [innerText]="messages.LAST_STEP_TXT"></span>\n      </div>\n    </div>\n  </div>\n</div>\n',styles:["body{background-color:var(--ls-grey-50)}.active-btn{color:#42a1e8}.ls-workflow-canevas{-ms-grid-column:1;grid-column:1;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.ls-workflow-step{background-color:#fff;-webkit-box-shadow:0 0 .25rem rgba(0,0,0,.15);box-shadow:0 0 .25rem rgba(0,0,0,.15);border:none;width:var(--ls-workflow-step-width,20rem);min-height:6rem}.ls-workflow-step .ls-step-top-line{padding:.5rem;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-weight:700}.ls-workflow-step .ls-display-step-separator{width:100%;border-bottom:1px solid #d3d3d3}.ls-workflow-step .ls-step-validator-list{padding:.5rem .5rem .5rem 1.5rem;color:#5b5b5b}.ls-workflow-step.selected{-webkit-box-shadow:0 .5rem .25rem rgba(0,0,0,.3);box-shadow:0 .5rem .25rem rgba(0,0,0,.3)}.ls-workflow-step .step-icn{width:1.7rem;height:1.7rem}.ls-workflow-endpoint-content{margin:auto;text-align:center}.ls-workflow-endpoint-content .ls-step-bounds-txt{color:var(--primary);font-weight:700}.ls-workflow-endpoint-content .ls-workflow-endpoint-icn{color:var(--primary)}.ls-workflow-endpoint-content.not-active .ls-step-bounds-txt,.ls-workflow-endpoint-content.not-active .ls-workflow-endpoint-icn{color:#5b5b5b}.ls-workflow-endpoint-content .ls-step-validator-list{text-align:left}.ls-actual-validator{font-weight:700}.ls-actual-validator::before{content:'\\f00c';font-family:FontAwesome;color:var(--primary);font-size:1em;position:absolute;left:.5em}.ls-rejector{font-weight:700}.ls-rejector::before{content:'\\f00d';font-family:FontAwesome;color:var(--danger);font-size:1em;position:absolute;left:.5em}.wa-comment-icon{color:var(--primary);font-size:1em;margin-right:.5em}.ls-workflow-display .ls-workflow-step{padding-left:0;padding-right:0;margin:1rem auto}.ls-workflow-display .ls-workflow-step .ls-step-validator-list{padding:1rem 1rem 1rem .5rem}.ls-workflow-display .ls-workflow-step .ls-step-validator-list.ls-workflow-instance{padding-left:2rem}.ls-workflow-display .ls-workflow-endpoint-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.ls-workflow-display .ls-workflow-endpoint-content .ls-step-bounds-txt{margin-left:.5rem}.ls-workflow-display .ls-step-top-line{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;padding-left:.5rem}.ls-workflow-display .ls-step-top-line .step-name{-webkit-box-flex:1;-ms-flex:1;flex:1;margin-left:.7rem}.ls-workflow-display .ls-display-step-separator{width:100%;border-bottom:1px solid #d3d3d3}.ls-workflow-display .ls-workflow-display-step-container{position:relative}.ls-workflow-display .ls-active-step .ls-step-top-line{background-color:var(--primary);color:#fff;margin:0}.ls-workflow-display .ls-active-step .ls-step-top-line .step-icn{color:#fff}.ls-workflow-display .ls-active-step::before{content:'\\f061';font-family:FontAwesome;color:var(--primary);font-size:2em;position:absolute;left:-1em}.ls-workflow-display .ls-active-step.end-step::before{font-size:1.2em}.ls-workflow-end{position:relative}"]}]}],c.ctorParameters=function(){return[]},c.propDecorators={passedStepTemplateRef:[{type:l.ContentChild,args:["passedStepContent"]}],pendingStepTemplateRef:[{type:l.ContentChild,args:["pendingStepContent"]}],circuit:[{type:l.Input}],activeStep:[{type:l.Input}],messages:[{type:l.Input}],getStepIconClassFct:[{type:l.Input}],getStepTooltipFct:[{type:l.Input}],getCircuitEndAdditionalClassesFct:[{type:l.Input}],isInstance:[{type:l.Input}]},c);function c(){this.isInstance=!1,this.isOver=!1,this.isRejected=!1}function w(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,s,i=o.call(t),r=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)r.push(n.value)}catch(l){s={error:l}}finally{try{n&&!n.done&&(o=i["return"])&&o.call(i)}finally{if(s)throw s.error}}return r}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(w(arguments[e]));return t}var m=(g.prototype.clone=function(){console.log("StepModel::clone");var t=new g;return t.name=this.name,t.type=this.type,t.validators=f(this.validators),t},g);function g(){this.validators=[]}var u=(Object.defineProperty(b.prototype,"localizedMessages",{get:function(){return this.messages},set:function(t){this.messages=Object.assign(this.messages,t)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"options",{get:function(){return this.activeOptions},set:function(t){this.activeOptions=Object.assign(this.activeOptions,t)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"workflow",{get:function(){return this.workflowData},set:function(t){this.workflowData=t,this.workflowChange.emit(t)},enumerable:!0,configurable:!0}),b.prototype.ngOnInit=function(){if(this.workflowData||(console.error("Missing input workflow data"),this.workflowData=new a),!this.messages)throw new Error("Missing localised messages for LsWorkflowViewerComponent!")},b.prototype.workflowDataChanged=function(){this.workflowChange.emit(this.workflowData)},b.prototype.askForStepDeletion=function(e){var o=this;console.debug("delete step"),this.confirmStepDeletionFct?this.confirmStepDeletionFct(this.workflowData.steps[e]).then(function(t){t&&o.deleteStep(e)}):this.deleteStep(e)},b.prototype.confirmStepCreation=function(t,e){this.addStep(t,e),this.closeCurrentPopover()},b.prototype.confirmStepEdition=function(t,e){this.replaceStep(t,e),this.closeCurrentPopover()},b.prototype.confirmFinalStepEdition=function(){this.closeCurrentPopover()},b.prototype.cancelStepEdition=function(){this.closeCurrentPopover()},b.prototype.cancelStepCreation=function(t){this.closeCurrentPopover()},b.prototype.isFirstStep=function(){return!this.workflowData||0===this.workflowData.steps.length},b.prototype.getAdditionalStepClass=function(t){return null!==this.currentEditedStepIdx&&this.currentEditedStepIdx===t?"selected":""},b.prototype.getStepIconClass=function(t){return this.getStepIconClassFct?this.getStepIconClassFct(t):""},b.prototype.getStepTooltip=function(t){return this.getStepTooltipFct?this.getStepTooltipFct(t):""},b.prototype.cloneStep=function(t){return t.clone()},b.prototype.createStep=function(t){var e=this,o=new m;this.currentPopover=this.getCreationPopoverForIdx(t),this.currentPopover.hidden.subscribe(function(){return e.cancelStepCreation(t)}),this.currentPopover.open({stepData:o,idx:t,cancelStepCreation:this.cancelStepCreation.bind(this),confirmStepCreation:this.confirmStepCreation.bind(this)})},b.prototype.editStep=function(t){var e=this;this.currentEditedStepIdx=t;var o=this.cloneStep(this.workflowData.steps[t]);this.currentPopover=this.getEditionPopoverForIdx(t),this.currentPopover.hidden.subscribe(function(){return e.cancelStepEdition()}),this.currentPopover.open({stepData:o,idx:t,cancelStepEdition:this.cancelStepEdition.bind(this),confirmStepEdition:this.confirmStepEdition.bind(this)})},b.prototype.editFinalStep=function(){var t=this,e=this.cloneStep(this.lastStepData);this.currentPopover=this.endpointPopoverElementRef,this.currentPopover.hidden.subscribe(function(){return t.cancelStepEdition()}),this.currentPopover.open({stepData:e,cancelStepEdition:this.cancelStepEdition.bind(this),confirmStepEdition:this.confirmFinalStepEdition.bind(this)})},b.prototype.drop=function(t){r.moveItemInArray(this.workflowData.steps,t.previousIndex,t.currentIndex),this.workflowDataChanged()},b.prototype.dragDisabledForIdx=function(t){return null!==this.currentEditedStepIdx&&this.currentEditedStepIdx===t},b.prototype.closeCurrentPopover=function(){this.currentPopover&&this.currentPopover.isOpen()&&this.currentPopover.close(),this.currentPopover=null,this.currentEditedStepIdx=null},b.prototype.addStep=function(t,e){this.workflowData.steps.splice(e,0,t),this.workflowDataChanged()},b.prototype.replaceStep=function(t,e){this.workflowData.steps.splice(e,1,t),this.workflowDataChanged()},b.prototype.deleteStep=function(t){this.workflowData.steps.splice(t,1),this.workflowDataChanged()},b.prototype.getCreationPopoverForIdx=function(t){return this.allCircuitEditionPopover.filter(function(t){t=t._elementRef;return!t||!t.nativeElement||t.nativeElement.hasAttribute("create-btn")})[t]},b.prototype.getEditionPopoverForIdx=function(t){return this.allCircuitEditionPopover.filter(function(t){t=t._elementRef;return!t||!t.nativeElement||!t.nativeElement.hasAttribute("create-btn")})[t]},b.decorators=[{type:l.Component,args:[{selector:"ls-workflow-editor",template:'<div class="ls-workflow-editor" [ngClass]="options.editorGlobalLayoutClass">\n  <div class="ls-workflow-canevas">\n    <div class="ls-workflow-start ls-workflow-endpoint">\n      <div class="ls-workflow-endpoint-content">\n        <div class="ls-workflow-endpoint-icn fa fa-2x" [ngClass]="options.startIconClass"></div>\n        <div class="ls-step-bounds-txt">{{messages.FIRST_STEP_TXT}}</div>\n      </div>\n    </div>\n    <div class="ls-workflow-stepList-container" cdkDropList (cdkDropListDropped)="drop($event)">\n      <div class="ls-workflow-link-container">\n        <div class="ls-workflow-link"></div>\n        <div [ngClass]="isFirstStep() ? \'firstStep\' : \'\'" class="ls-link-button-container">\n          <div (click)="createStep(0)" [autoClose]="\'outside\'" [ngbPopover]="popCreateContent"\n               [popoverTitle]="messages.popCreateTitle" class="add-step-btn" create-btn\n               placement="right" popoverClass="ls-step-edition-popover"\n               triggers="manual"\n               autoClose="false">\n            <span class="fa fa-plus-circle"></span>\n            <span class="add-step-btn-txt">{{messages.ADD_STEP_BTN_TXT}}</span>\n          </div>\n        </div>\n      </div>\n\n      <div *ngFor="let step of workflowData.steps; index as i">\n        <div class="ls-workflow-step-container" cdkDrag [cdkDragDisabled]="dragDisabledForIdx(i)">\n          <div [ngClass]="getAdditionalStepClass(i)" class="ls-workflow-step">\n            <div class="ls-step-top-line">\n              <div class="step-number">{{i + 1}}.</div>\n              <div class="step-name">{{step.name}}</div>\n              <div [ngClass]="getStepIconClass(step)" class="step-icn fa" ngbTooltip="{{getStepTooltip(step)}}"></div>\n            </div>\n            <div class="ls-step-validator-list">\n              <ng-template\n                [ngTemplateOutlet]="stepDisplayContentRef"\n                [ngTemplateOutletContext]="{step: step}">\n              </ng-template>\n            </div>\n          </div>\n          <div class="ls-workflow-step-external-buttons">\n            <div (click)="editStep(i)" [autoClose]="\'outside\'" [ngbPopover]="popEditContent"\n                 [popoverTitle]="messages.popEditTitle" class="fa fa-pencil-alt fa-pencil edit-step-btn"\n                 placement="right-top"\n                 popoverClass="ls-step-edition-popover"\n                 triggers="manual"></div>\n            <div (click)="askForStepDeletion(i)" class="fa fa-trash delete-step-btn"></div>\n          </div>\n        </div>\n\n        <div class="ls-workflow-link-container">\n          <div class="ls-workflow-link"></div>\n          <div class="ls-link-button-container">\n            <div (click)="createStep(i + 1)" [autoClose]="\'outside\'" [ngbPopover]="popCreateContent"\n                 [popoverTitle]="messages.popCreateTitle" class="add-step-btn" create-btn\n                 placement="right" popoverClass="ls-step-edition-popover"\n                 triggers="manual"\n                 autoClose="false">\n              <span class="fa fa-plus-circle"></span>\n              <span class="add-step-btn-txt">{{messages.ADD_STEP_BTN_TXT}}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n    <div class="ls-workflow-end ls-workflow-endpoint" [ngClass]="options.additionalFinalEndpointClasses">\n      <ng-container *ngIf="endpointIsEditable">\n        <div\n          #endpointPopoverHandle\n          (click)="editFinalStep()"\n          [autoClose]="\'outside\'"\n          [ngbPopover]="popEditFinalStepContent"\n          [popoverTitle]="messages.popEditTitle"\n          class="ls-workflow-endpoint-overlay"\n          placement="right"\n          popoverClass="ls-step-edition-popover"\n          triggers="manual">\n\n        </div>\n      </ng-container>\n      <div class="ls-workflow-endpoint-content">\n        <div class="ls-workflow-endpoint-icn-group">\n          <div class="ls-workflow-endpoint-icn fa fa-2x" [ngClass]="options.endIconClass"></div>\n          <div class="ls-step-bounds-txt">{{messages.LAST_STEP_TXT}}</div>\n        </div>\n        <div *ngIf="endpointIsEditable" class="ls-step-validator-list">\n          <ng-template [ngTemplateOutlet]="lastStepDisplayContentRef">\n          </ng-template>\n        </div>\n      </div>\n\n    </div>\n  </div>\n</div>\n\n<ng-template\n  #popEditContent\n  let-idx="idx"\n  let-stepData="stepData"\n  let-cancelStepEdition="cancelStepEdition"\n  let-confirmStepEdition="confirmStepEdition">\n  <ng-template\n    [ngTemplateOutlet]="popEditContentTemplateRef"\n    [ngTemplateOutletContext]="{idx:idx, stepData:stepData, cancelStepEdition:cancelStepEdition, confirmStepEdition:confirmStepEdition}">\n  </ng-template>\n</ng-template>\n\n<ng-template\n  #popCreateContent\n  let-idx="idx"\n  let-stepData="stepData"\n  let-cancelStepCreation="cancelStepCreation"\n  let-confirmStepCreation="confirmStepCreation">\n  <ng-template\n    [ngTemplateOutlet]="popCreateContentTemplateRef"\n    [ngTemplateOutletContext]="{idx:idx, stepData:stepData, cancelStepCreation:cancelStepCreation, confirmStepCreation:confirmStepCreation}">\n  </ng-template>\n</ng-template>\n\n\n<ng-template\n  #popEditFinalStepContent\n  let-stepData="stepData"\n  let-cancelStepEdition="cancelStepEdition"\n  let-confirmStepEdition="confirmStepEdition">\n  <ng-template\n    [ngTemplateOutlet]="endpointPopoverEditContentRef"\n    [ngTemplateOutletContext]="{stepData:stepData, cancelStepEdition:cancelStepEdition, confirmStepEdition:confirmStepEdition, isLastStep:true}">\n  </ng-template>\n</ng-template>\n',styles:['body{background-color:var(--ls-grey-50)}.active-btn{color:#42a1e8}.ls-workflow-canevas{-ms-grid-column:1;grid-column:1;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.ls-workflow-endpoint.with-content,.ls-workflow-step{background-color:#fff;-webkit-box-shadow:0 0 .25rem rgba(0,0,0,.15);box-shadow:0 0 .25rem rgba(0,0,0,.15);border:none;width:var(--ls-workflow-step-width,20rem);min-height:6rem}.ls-workflow-endpoint.with-content .ls-step-top-line,.ls-workflow-step .ls-step-top-line{padding:.5rem;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-weight:700}.ls-workflow-endpoint.with-content .ls-display-step-separator,.ls-workflow-step .ls-display-step-separator{width:100%;border-bottom:1px solid #d3d3d3}.ls-workflow-endpoint.with-content .ls-step-validator-list,.ls-workflow-step .ls-step-validator-list{padding:.5rem .5rem .5rem 1.5rem;color:#5b5b5b}.ls-workflow-step.selected,.selected.ls-workflow-endpoint.with-content{-webkit-box-shadow:0 .5rem .25rem rgba(0,0,0,.3);box-shadow:0 .5rem .25rem rgba(0,0,0,.3)}.ls-workflow-endpoint.with-content .step-icn,.ls-workflow-step .step-icn{width:1.7rem;height:1.7rem}.ls-workflow-endpoint-content{margin:auto;text-align:center}.ls-workflow-endpoint-content .ls-step-bounds-txt{color:var(--primary);font-weight:700}.ls-workflow-endpoint-content .ls-workflow-endpoint-icn{color:var(--primary)}.ls-workflow-endpoint-content.not-active .ls-step-bounds-txt,.ls-workflow-endpoint-content.not-active .ls-workflow-endpoint-icn{color:#5b5b5b}.ls-workflow-endpoint-content .ls-step-validator-list{text-align:left}.ls-horizontal-separation-line{margin-top:2rem;border-bottom:1px solid #5b5b5b}.ls-workflow-endpoint{background-color:#fff;-webkit-box-shadow:0 0 .25rem rgba(0,0,0,.15);box-shadow:0 0 .25rem rgba(0,0,0,.15);border:none;display:-ms-grid;display:grid;width:6rem;height:6rem;border-radius:50%;position:relative}.ls-workflow-endpoint.with-content{display:block;width:var(--ls-workflow-step-width,20rem);border-radius:0}.ls-workflow-endpoint.with-content .ls-workflow-endpoint-content{width:100%;height:100%;padding:.5em}.ls-workflow-endpoint.with-content .ls-workflow-endpoint-content .ls-workflow-endpoint-icn-group{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;padding:0 .5em}.ls-workflow-endpoint.with-content .ls-workflow-endpoint-content .ls-workflow-endpoint-icn-group:after{content:\'\';display:block;width:2em}.ls-workflow-endpoint .ls-workflow-endpoint-overlay{width:100%;height:100%;position:absolute;left:0;bottom:0;z-index:2;cursor:pointer}.ls-workflow-link{width:0;border:1px solid #222}.cdk-drag-preview .ls-workflow-endpoint.with-content,.cdk-drag-preview .ls-workflow-step{-webkit-box-shadow:0 .5rem .25rem rgba(0,0,0,.3);box-shadow:0 .5rem .25rem rgba(0,0,0,.3)}.cdk-drag-placeholder{min-height:6rem}.cdk-drag-placeholder .ls-workflow-endpoint.with-content,.cdk-drag-placeholder .ls-workflow-step,.cdk-drag-placeholder .ls-workflow-step-external-buttons{display:none}.cdk-drop-list-dragging .cdk-drag{-webkit-transition:-webkit-transform 250ms cubic-bezier(0,0,.2,1);transition:transform 250ms cubic-bezier(0,0,.2,1);transition:transform 250ms cubic-bezier(0,0,.2,1),-webkit-transform 250ms cubic-bezier(0,0,.2,1)}.cdk-drag-animating{-webkit-transition:-webkit-transform .3s cubic-bezier(0,0,.2,1);transition:transform .3s cubic-bezier(0,0,.2,1);transition:transform .3s cubic-bezier(0,0,.2,1),-webkit-transform .3s cubic-bezier(0,0,.2,1)}.ls-workflow-link-container{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;min-height:4rem;min-width:20rem}.ls-workflow-link-container::before{content:"";-webkit-box-flex:0;-ms-flex:0 0 calc(50% - 2px);flex:0 0 calc(50% - 2px)}.ls-workflow-link-container .ls-link-button-container{-webkit-box-flex:0;-ms-flex:0 0 calc(50% - 2px);flex:0 0 calc(50% - 2px);-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center;height:-webkit-min-content;height:-moz-min-content;height:min-content;width:-webkit-min-content;width:-moz-min-content;width:min-content;padding-left:1rem}.ls-workflow-stepList-container{width:100%}.ls-workflow-step-container{-ms-flex-item-align:center;align-self:center;margin-left:auto;margin-right:auto;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.ls-workflow-step-container::before{content:"";-webkit-box-flex:0;-ms-flex:0 0 5rem;flex:0 0 5rem}.ls-workflow-step-container .ls-workflow-endpoint.with-content,.ls-workflow-step-container .ls-workflow-step{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.ls-workflow-step-container .ls-workflow-step-external-buttons{padding-left:1rem;height:-webkit-min-content;height:-moz-min-content;height:min-content;-webkit-box-flex:0;-ms-flex:0 0 5rem;flex:0 0 5rem}.ls-workflow-step-external-buttons{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.ls-workflow-step-external-buttons .edit-step-btn{margin-right:1rem;cursor:pointer}.ls-workflow-step-external-buttons .edit-step-btn:hover{color:var(--primary)}.ls-workflow-step-external-buttons .delete-step-btn{cursor:pointer}.ls-workflow-step-external-buttons .delete-step-btn:hover{color:var(--danger)}.ls-workflow-editor{display:-ms-grid;display:grid;height:100%}.ls-workflow-editor .ls-link-button-container .add-step-btn{width:-webkit-max-content;width:-moz-max-content;width:max-content;cursor:pointer}.ls-workflow-editor .ls-link-button-container .add-step-btn .add-step-btn-txt{margin-left:.5em;opacity:0;-webkit-transition:opacity .2s ease-in-out;transition:opacity .2s ease-in-out}.ls-workflow-editor .ls-link-button-container.firstStep .add-step-btn .add-step-btn-txt,.ls-workflow-editor .ls-link-button-container:hover .add-step-btn .add-step-btn-txt{opacity:100}.ls-workflow-editor-default-layout{-ms-grid-columns:66% auto;grid-template-columns:66% auto;-ms-grid-rows:100%;grid-template-rows:100%}@media (min-width:1400px){.container{max-width:1340px}}@media (min-width:1600px){.container{max-width:1540px}}']}]}],b.ctorParameters=function(){return[]},b.propDecorators={endpointPopoverElementRef:[{type:l.ViewChild,args:["endpointPopoverHandle",{read:i.NgbPopover}]}],allCircuitEditionPopover:[{type:l.ViewChildren,args:[i.NgbPopover]}],popEditContentTemplateRef:[{type:l.ContentChild,args:["popEditContent"]}],popCreateContentTemplateRef:[{type:l.ContentChild,args:["popCreateContent"]}],endpointPopoverEditContentRef:[{type:l.ContentChild,args:["endpointPopoverEditContent"]}],stepDisplayContentRef:[{type:l.ContentChild,args:["stepDisplayContent"]}],lastStepDisplayContentRef:[{type:l.ContentChild,args:["lastStepDisplayContent"]}],endpointIsEditable:[{type:l.Input}],getStepIconClassFct:[{type:l.Input}],getStepTooltipFct:[{type:l.Input}],confirmStepDeletionFct:[{type:l.Input}],lastStepData:[{type:l.Input}],workflowChange:[{type:l.Output}],localizedMessages:[{type:l.Input}],options:[{type:l.Input}],workflow:[{type:l.Input}]},b);function b(){this.messages={CREATE_STEP_TITLE:"Ajouter une étape",EDIT_STEP_TITLE:"Modification de l'étape",ADD_STEP_BTN_TXT:"Ajouter une étape",FIRST_STEP_TXT:"Début",LAST_STEP_TXT:"Fin"},this.activeOptions={startIconClass:"far fa-flag",endIconClass:"fas fa-flag-checkered",editorGlobalLayoutClass:"ls-workflow-editor-default-layout",additionalFinalEndpointClasses:""},this.endpointIsEditable=!1,this.workflowChange=new l.EventEmitter}var k=function(t){this.currentStepIdx=0,this.rejected=!1,this.isOver=!1,this.id=t.id,this.name=t.name,this.description=t.description,this.rejected=t.isRejected,this.isOver=t.isOver,t.steps&&(this.steps=t.steps,this.currentStepIdx=t.steps.findIndex(function(t){return t.state===p.CURRENT}),-1===this.currentStepIdx&&(this.currentStepIdx=0))},h=(Object.defineProperty(v.prototype,"options",{get:function(){return this._options},set:function(t){this._options=Object.assign(this._options,t)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"localizedMessages",{get:function(){return this.messages},set:function(t){this.messages=Object.assign(this.messages,t)},enumerable:!0,configurable:!0}),v.prototype.ngOnInit=function(){if(console.warn("instanciating ls workflow instance viewer!"),this.workflowData||(console.error("Missing input circuit data"),this.workflowData=new k),!this.messages)throw new Error("Missing localised messages for LsWorkflowViewerComponent!");if(!this.getStepIconClassFct)throw new Error("Missing getStepIconClassFct for LsWorkflowViewerComponent!");if(!this.getStepTooltipFct)throw new Error("Missing getStepTooltipFct for LsWorkflowViewerComponent!")},v.prototype.ngOnChanges=function(){console.debug("LsWorkflowViewerComponent::ngOnChanges, ",this),this.activeStep=this.workflowData.currentStepIdx,this.isOver=this.workflowData.isOver,this.isRejected=this.workflowData.rejected},v.prototype.getStepIconClass=function(t){return this.getStepIconClassFct(t)},v.prototype.getStepTooltip=function(t){return this.getStepTooltipFct(t)},v.prototype.isActiveStep=function(t){return!this.isRejected&&!this.isOver&&t===this.activeStep},v.prototype.isPassed=function(t){return t.state===p.VALIDATED||t.state===p.REJECTED},v.prototype.isActualValidator=function(t,e){return t.validatedBy.some(function(t){return t.id===e.id})},v.prototype.isCircuitOver=function(){return this.isOver&&!this.isRejected},v.prototype.getCircuitEndAdditionalClasses=function(){var t=[];return this.getCircuitEndAdditionalClassesFct?t.push(this.getCircuitEndAdditionalClassesFct()):t.push(this._options.additionalFinalEndpointClasses||""),this.reducedMode&&t.push("reduced-end-step"),t},v.prototype.getAdditionalValidatorListClasses=function(){},v.prototype.getStepAdditionalClasses=function(t,e){var o=[];return this.isActiveStep(e)&&o.push("ls-active-step ls-white-icn"),this.reducedMode&&o.push("ls-reduced-step"),this.reducedMode||t.state===p.SKIPPED&&o.push("wa-circuit-skipped-step"),t.state===p.VALIDATED&&o.push("ls-validated-step"),o},v.prototype.getValidatorClasses=function(t,e){return this.isActualValidator(t,e)?t.state===p.REJECTED?this.options.rejectedIconClass:this.options.validatedIconClass:""},v.decorators=[{type:l.Component,args:[{selector:"ls-workflow-instance-viewer",template:'<div class="ls-workflow-display">\n  <div class="ls-workflow-canevas">\n    <div class="circuit-start">\n      <div *ngIf="!options.hideStart" class="ls-workflow-endpoint-content">\n        <span class="ls-workflow-endpoint-icn fa fa fa-2x" [ngClass]="options.startIconClass"></span>\n        <span class="ls-step-bounds-txt" [innerText]="messages.FIRST_STEP_TXT"></span>\n      </div>\n    </div>\n    <div class="steps-container">\n      <div *ngFor="let step of workflowData.steps; index as i">\n        <div class="ls-workflow-display-step-container">\n          <div class="ls-workflow-step" [ngClass]="getStepAdditionalClasses(step, i)">\n            <div class="ls-step-top-line">\n              <div class="step-number">{{i + 1}}.</div>\n              <div class="step-name">{{step.name}}</div>\n              <div [ngClass]="getStepIconClass(step)" class="step-icn fa" ngbTooltip="{{getStepTooltip(step)}}"></div>\n            </div>\n            <div class="ls-display-step-separator"></div>\n            <div class="ls-step-validator-list" [ngClass]="getAdditionalValidatorListClasses">\n              <ng-container *ngIf="isPassed(step)">\n                <div *ngFor="let validator of step.validators">\n                  <ng-template\n                    [ngTemplateOutlet]="passedStepTemplateRef"\n                    [ngTemplateOutletContext]="{step: step, validator: validator}">\n                  </ng-template>\n                </div>\n              </ng-container>\n              <ng-container *ngIf=" ! isPassed(step)">\n                <div *ngFor="let validator of step.validators" class="ls-step-validator">\n                  <ng-template\n                    [ngTemplateOutlet]="pendingStepTemplateRef"\n                    [ngTemplateOutletContext]="{step: step, validator: validator}">\n                  </ng-template>\n                </div>\n              </ng-container>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="ls-workflow-end" [ngClass]="getCircuitEndAdditionalClasses()">\n      <div class="ls-workflow-endpoint-content">\n        <span class="ls-workflow-endpoint-icn fa fa-2x" [ngClass]="options.endIconClass"></span>\n        <span class="ls-step-bounds-txt" [innerText]="messages.LAST_STEP_TXT"></span>\n      </div>\n    </div>\n  </div>\n</div>\n',styles:["body{background-color:var(--ls-grey-50)}.active-btn{color:#42a1e8}.ls-workflow-canevas{-ms-grid-column:1;grid-column:1;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.ls-workflow-step{background-color:#fff;-webkit-box-shadow:0 0 .25rem rgba(0,0,0,.15);box-shadow:0 0 .25rem rgba(0,0,0,.15);border:none;width:var(--ls-workflow-step-width,20rem);min-height:6rem}.ls-workflow-step .ls-step-top-line{padding:.5rem;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-weight:700}.ls-workflow-step .ls-display-step-separator{width:100%;border-bottom:1px solid #d3d3d3}.ls-workflow-step .ls-step-validator-list{padding:.5rem .5rem .5rem 1.5rem;color:#5b5b5b}.ls-workflow-step.selected{-webkit-box-shadow:0 .5rem .25rem rgba(0,0,0,.3);box-shadow:0 .5rem .25rem rgba(0,0,0,.3)}.ls-workflow-step .step-icn{width:1.7rem;height:1.7rem}.ls-workflow-endpoint-content{margin:auto;text-align:center}.ls-workflow-endpoint-content .ls-step-bounds-txt{color:var(--primary);font-weight:700}.ls-workflow-endpoint-content .ls-workflow-endpoint-icn{color:var(--primary)}.ls-workflow-endpoint-content.not-active .ls-step-bounds-txt,.ls-workflow-endpoint-content.not-active .ls-workflow-endpoint-icn{color:#5b5b5b}.ls-workflow-endpoint-content .ls-step-validator-list{text-align:left}.ls-actual-validator{font-weight:700}.ls-actual-validator::before{content:'\\f00c';font-family:var(--ls-font-awesome-family, \"Font Awesome 5 Free\");color:var(--primary);font-size:1em;position:absolute;left:.5em}.ls-rejector{font-weight:700}.ls-rejector::before{content:'\\f00d';font-family:var(--ls-font-awesome-family, \"Font Awesome 5 Free\");color:var(--danger);font-size:1em;position:absolute;left:.5em}.wa-comment-icon{color:var(--primary);font-size:1em;margin-right:.5em}.ls-workflow-display .ls-workflow-step{padding-left:0;padding-right:0;margin:1rem auto}.ls-workflow-display .ls-workflow-step .ls-step-validator-list{padding:1rem 1rem 1rem .5rem}.ls-workflow-display .ls-workflow-step .ls-step-validator-list.ls-workflow-instance{padding-left:2rem}.ls-workflow-display .ls-workflow-step.ls-reduced-step{-webkit-box-shadow:none;box-shadow:none;border:none;background-color:rgba(0,0,0,0);width:var(--ls-workflow-reduced-step-width,16rem);min-height:unset;display:-ms-grid;display:grid;-ms-grid-columns:(1fr)[12];grid-template-columns:repeat(12,1fr);-ms-grid-rows:2em auto;grid-template-rows:2em auto;grid-row-gap:.5em}.ls-workflow-display .ls-workflow-step.ls-reduced-step .ls-step-top-line{grid-column:1/-1;-ms-grid-row:1;grid-row:1;display:-ms-grid;display:grid;-ms-grid-columns:1fr 2fr 9fr;grid-template-columns:1fr 2fr 9fr;-ms-grid-rows:1fr;grid-template-rows:1fr;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0}.ls-workflow-display .ls-workflow-step.ls-reduced-step .ls-step-top-line .step-number{display:none}.ls-workflow-display .ls-workflow-step.ls-reduced-step .ls-step-top-line .step-icn{-ms-grid-column:2;grid-column:2;-ms-grid-row:1;grid-row:1;font-size:24px;margin:auto;width:unset;height:unset}.ls-workflow-display .ls-workflow-step.ls-reduced-step .ls-step-top-line .step-name{-ms-grid-column:3;grid-column:3;-ms-grid-row:1;grid-row:1}.ls-workflow-display .ls-workflow-step.ls-reduced-step .ls-display-step-separator{-ms-grid-column:3;grid-column:3;-ms-grid-row:2;grid-row:2;border-left:1px solid #d3d3d3;border-bottom:0}.ls-workflow-display .ls-workflow-step.ls-reduced-step .ls-step-validator-list{grid-column:4/-1;-ms-grid-row:2;grid-row:2;padding:.5em;font-size:.8rem;font-style:italic;color:#d3d3d3}.ls-workflow-display .ls-workflow-step.ls-reduced-step.ls-validated-step .ls-step-top-line,.ls-workflow-display .ls-workflow-step.ls-reduced-step.ls-validated-step .ls-step-top-line .step-icn.test-icon-class,.ls-workflow-display .ls-workflow-step.ls-reduced-step.ls-validated-step .ls-step-top-line .step-icn.test-icon-class:before{color:#23a237}.ls-workflow-display .reduced-end-step .ls-workflow-endpoint-content .ls-step-bounds-txt{margin-left:1em}.ls-workflow-display .ls-workflow-endpoint-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.ls-workflow-display .ls-workflow-endpoint-content .ls-step-bounds-txt{margin-left:.5rem}.ls-workflow-display .ls-step-top-line{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;padding-left:.5rem}.ls-workflow-display .ls-step-top-line .step-name{-webkit-box-flex:1;-ms-flex:1;flex:1;margin-left:.7rem}.ls-workflow-display .ls-workflow-display-step-container{position:relative}.ls-workflow-display .ls-active-step:not(.ls-reduced-step) .ls-step-top-line{background-color:var(--primary);color:#fff;margin:0}.ls-workflow-display .ls-active-step:not(.ls-reduced-step) .ls-step-top-line .step-icn{color:#fff}.ls-workflow-display .ls-active-step::before{content:'\\f061';font-family:var(--ls-font-awesome-family, \"Font Awesome 5 Free\");font-style:normal;font-variant:normal;text-rendering:auto;line-height:1;font-weight:900;color:var(--ls-workflow-arrow-color,var(--primary));font-size:2em;position:absolute;left:-1em}.ls-workflow-display .ls-active-step.end-step::before{font-size:1.2em}.ls-workflow-end{position:relative}"]}]}],v.ctorParameters=function(){return[]},v.propDecorators={passedStepTemplateRef:[{type:l.ContentChild,args:["passedStepContent"]}],pendingStepTemplateRef:[{type:l.ContentChild,args:["pendingStepContent"]}],workflowData:[{type:l.Input,args:["src"]}],activeStep:[{type:l.Input}],getStepIconClassFct:[{type:l.Input}],getStepTooltipFct:[{type:l.Input}],getCircuitEndAdditionalClassesFct:[{type:l.Input}],reducedMode:[{type:l.Input}],options:[{type:l.Input}],localizedMessages:[{type:l.Input}]},v);function v(){this.messages={FIRST_STEP_TXT:"Start",LAST_STEP_TXT:"End"},this.reducedMode=!0,this.isOver=!1,this.isRejected=!1,this._options={startIconClass:"far fa-flag",endIconClass:"fas fa-flag-checkered",validatedIconClass:"fas fa-check",rejectedIconClass:"fas fa-times",hideStart:!1}}x.decorators=[{type:l.NgModule,args:[{declarations:[u,d,h],imports:[s.BrowserModule,n.CommonModule,e.BrowserAnimationsModule,o.FormsModule,i.NgbModule,r.DragDropModule],exports:[u,d,h]}]}],x.ctorParameters=function(){return[]},s=x;function x(){}n=function(t){this.validatedBy=[],this.id=t.id,this.name=t.name,this.validators=t.validators?f(t.validators):[],this.state=t.state,this.validatedBy=t.actedUponBy?[t.actedUponBy]:[],this.comment=t.comment,t.actionId&&(this.id=t.actionId)},e=function(){},o=function(){},i=function(){};t.LsWorkflowsModule=s,t.StepInstance=n,t.StepState=p,t.StepModel=m,t.WorkflowActor=e,t.WorkflowInstance=k,t.WorkflowModel=a,t.WorkflowModelOptions=o,t.WorkflowModelLocalizedMessages=i,t.ɵa=u,t.ɵc=h,t.ɵb=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=libriciel-ls-composants-workflows.umd.min.js.map